Mikrotik MTCTCE
Модуль 2. Брандмауэр. Тема 2. Фильтр
Firewall Filter и Mangle - объяснить назначение опций во вкладке “Advanced”:
Src. Address List
Dst. Address List
Layer7 Protocol
Connection Bytes
Connection Rate
Per Connection Classifier
Src. MAC Address
Out. Bridge Port
In. Bridge Port
In. Bridge Port List
Out. Bridge Port List
IPsec Policy
TLS Host
Ingress Priority
Priority
DSCP (TOS)
TCP MSS
Packet Size
Random
TCP Flags
ICMP Options
Ответ:
Единый набор будет содержаться как в Filter, так и в Mangle.
Src. Address List – адресный список, в котором указаны адреса источники пакета. Это удобно, когда у нас адреса находятся ни в каком-то связанном диапазоне, а находится в разнобой, например, список адресов для ya.ru, чтобы в итоге не делать правила отдельно для каждого адреса.
Dst. Address List – адресный список, в котором указаны адреса назначения пакета.
Layer7 Protocol – совпадение с фильтром, указанным в L7-фильтре (/ip firewall layer7-protocol). L7 Protocol - это специальный фильтр, который работает на седьмом уровне модели OSI и позволяет отфильтровать определенные виды трафика, находя в них что-то идентичное, например, отфильтровать именно http трафик не по номеру порта, а по содержимому, либо SSH трафик, также не по номеру порта, а по приложению VNC.
Content – пакет содержит определенный текст.
Connection Bytes – совпадение с пакетами после того, как через соединение прошло заданное количество Байт. 0 – бесконечность. Например, connection-bytes=2000000-0 (да, именно такая запись 2000000-0, где 0 означает бесконечность) - значит, что правило начнет работать после того, как через соединение пройдет более 2Мбит трафика и до бесконечности (непонятно, почему тут указанно 2Мбит, хотя автор говорит, что Connection Bytes отвечает за объем проходящего трафика, именно в Байтах, а не Битах, причем автор себя постоянно поправляет, что он оговаривается и нужно говорить байты (просто скорость обычно в битах измеряется, поэтому легко можно спутать)). Т. к. речь идет о соединении, которое является двунаправленным, то учитываются данные, проходящие в обе стороны. Работает только с протоколами TCP и UDP. Единица измерения Байт.
Connection Rate – совпадение на основании заданной скорости соединения. Например, connection-rate=0-256000, значит, что правило сработает, когда скорость соединения будет менее 256 Кбит/с. Т. к. речь идет о соединении, которое является двунаправленным, то учитываются данные, проходящие в обе стороны, то есть если у нас одновременно идет выгрузка и загрузка, то будет показана суммарная скорость. К примеру, если в одну сторону выгружаем 1,5 Мбит и при этом одновременно загружаем 2 Мбит, то скорость будет считаться как 3 Мбит, то есть скорость соединения в обе стороны. Работает только с протоколами TCP и UDP. Единица измерения бит. Невозможно указать в Connection Rate 1М-2M, так как система не будет признавать такую запись, придется писать именно 1000000-2000000.
Per Connection Classifier – позволяет разделить трафик на несколько потоков с возможностью держать пакеты с определенным набором опций в одном потоке. Числитель – суммарное количество потоков, знаменатель – конкретный субпоток. Отсчет знаменателя начинается с 0 (это значит, что если числитель будет указан 3, то субпотоки можно будет указывать 0, 1 или 2, так как отсчет потоков идет с 0, а потоков всего - 3). Эта опция позволяет разделить трафик на несколько потоков с возможностью держать пакеты с определенным набором опций в раздельном потоке, очень часто используется, когда нам необходимо, например, сделать балансировку нагрузки, а также часто используется при маркировке трафика.
Src. MAC Address – MAC-адрес источника. Поскольку компьютеры общаются по MAC-адресам внутри одной локальной сети, внутри одного широковещательного домета, то как результат, это опция применима, только если источник находится в одном Ethernet-сегменте с маршрутизатором.
Out. Bridge Port – интерфейс типа “bridge”, с которого пакет должен уйти, если исходящий интерфейс это bridge. Применимо только, если опция “use-ip-firewall” включена в настройках Bridge.
In. Bridge Port – интерфейс типа “bridge”, на который пакет должен прийти, если входящий интерфейс это bridge. Применимо только, если опция “use-ip-firewall” включена в настройках Bridge.
In. Bridge Port List – список интерфейсов типа “bridge”, на которые пакет должен прийти, если исходящий интерфейс это bridge.
Out. Bridge Port List – список интерфейсов типа “bridge”, с которых пакет должен уйти, если входящий интерфейс это bridge.
IPsec Policy – совпадение с политикой IPSec. Задается в формате: направление, политика. Направление используется для выбора совпадения с политикой, которая используется для декапсуляции или политикой, которая используется для инкапсуляции.
  o in – применимо для цепочек Prerouting, Input и Forward;
  o out – применимо для цепочек Postrouting, Output и Forward;
  o ipsec – совпадает, если пакет является предметом обработки IPSec;
  o none – совпадает, если пакет не является предметом IPSec обработки. Например, транспортный IPSec пакет.
TLS Host – возможность указать доменное имя https:// сайта. Условие не сработает, если кадр TLS-рукопожатия будет фрагментирован во множество пакетов. По этой причине многие сайты не попадают под действие этого условия. Возможно использование масок:
  o * – любое количество любых символов. Примеры: Law* = Law, Laws или Lawyer, *Law* = Law, GrokLaw, или Lawyer.
  o ? – один любой символ. Пример: ?at = Cat, cat, Bat or bat, но не равно at.
  o [abc] – один любой символ из списка. Пример: [CB]at = Cat or Bat, но не равно cat или bat.
  o [a - z] – один любой символ из диапазона. Пример: Letter[0-9] = Letter0, Letter1, Letter2 и т. д. до Letter9, но не равно Letters, Letter or Letter10
Ingress Priority – приоритет пакета, который может быть получен из VLAN, WMM или MPLS EXP bit.
Priority – приоритет пакета, который измеряется от 1 до 8.
DSCP (TOS) – DSCP, указанный в заголовке пакета.
TCP MSS – значение MSS пакета TCP.
Packet Size – размер пакета.
Random – совпадение в случайном порядке. Может иметь значение от 1 до 99. Что соответствует вероятности срабатывания правила от 1% до 99%. Обычно используется, когда надо изобразить случайную потерю пакетов.
TCP Flags – флаги TCP соединения.
ICMP Options – типы сообщений ICMP.
  o IPv4 Options – IPv4 опции.
  o TTL – значение TTL.
